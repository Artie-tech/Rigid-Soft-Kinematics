# Rigid-Soft Kinematics / src_demo 说明

本目录包含刚柔耦合液压软体机械臂的主要 Python 演示与调试脚本。

## 文件概览

- `main.py`  
  统一的演示入口。集成刚性+软体运动学模型和逆运动学求解器，使用 `matplotlib` 实时 3D 可视化机械臂。支持三种模式：
  - **MANUAL**：通过左侧滑块手动控制关节和软体参数。
  - **AUTO**：自动生成一条循环轨迹，机械臂持续运动演示。
  - **GRASP**：键盘控制目标球位置（方向键和小键盘 +/-），调用逆运动学尝试抓取，并在界面上显示是否可达及失败原因（超出工作空间、关节限位等）。

- `robot_model.py`  
  机器人运动学模型：
  - 定义 3 个刚性关节 + 1 段刚性延长杆 + 软体段的结构参数（D-H 参数 + PCC 模型）。
  - `HydraulicSoftArmKinematics.forward_kinematics(q)` 计算：
    - 刚性各关节空间位置；
    - 软体段离散点坐标（20 段常曲率圆弧）；
    - 软体基座与末端的齐次变换矩阵（用于绘制末端坐标轴、IK 等）。

- `ik_solver.py`  
  逆运动学求解器：
  - 使用数值雅可比（包括刚性 3 关节 + 软体 3 参数 + 长度）的梯度下降 / 阻尼最小二乘法求解末端位置到目标点的关节配置。
  - 内置关节限位与基本工作空间检测，并在求解失败时提供诊断信息（如：超出工作空间、关节到达限位、奇异位形、未收敛等）。
  - 供 `main.py` 的 GRASP 模式调用。

- `test_ik.py`  
  逆运动学单元测试脚本：
  - 随机生成一个大概率可达的目标点；
  - 调用 `IKSolver` 求解；
  - 使用 `HydraulicSoftArmKinematics` 做正向运动学验证末端误差；
  - 用于调试 IK 的精度和收敛情况。

- `workspace_test.py`  
  工作空间采样和可视化脚本：
  - 随机采样大量关节角 / 软体参数组合；
  - 调用正向运动学，收集末端坐标点；
  - 将点云画出，展示机械臂近似工作空间形状。

- `__pycache__/`  
  Python 自动生成的字节码缓存目录，可忽略。

## 运行方式

在 `src_demo` 目录下，推荐使用已配置好的 Python 环境运行：

```powershell
cd "e:\Code_Lib\Rigid Soft Kinematics\src_demo"

# 运行主可视化程序
python main.py

# 单独测试逆运动学
python test_ik.py

# 采样并可视化工作空间（如果脚本已完整实现绘图）
python workspace_test.py
```

## 控制说明（main.py）

- 模式切换：窗口左上角三个按钮 `Manual / Auto / Grasp`。
- MANUAL：拖动左侧滑块调整 J1–J3、软体弯曲角 Bend、方向 Phi、长度 Len。
- AUTO：自动播放预设轨迹，无需手动干预。
- GRASP：
  - 方向键 `↑ ↓ ← →` / 小键盘 `8 2 4 6`：移动目标球的 X/Y 方向；
  - 小键盘 `+ / -`：调节目标球高度 Z；
  - 程序自动调用 IK，末端会尝试跟随目标点；若失败，标题栏和图中会给出失败类型和文本说明。

如后续新增脚本（例如更复杂的任务规划 `task_planner.py`），可以按上述风格在此 README 中补充对应说明。